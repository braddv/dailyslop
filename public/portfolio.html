<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Portfolio Analytics</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f7f7f7; }
    .card { background: white; border-radius: 8px; padding: 16px; margin-bottom: 16px; box-shadow: 0 1px 4px rgba(0,0,0,0.08); }
    table { border-collapse: collapse; width: 100%; font-size: 13px; }
    th, td { border: 1px solid #ddd; padding: 6px; text-align: left; }
    .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
    .heat td { text-align: center; }
    .warn { color: #a20000; font-weight: bold; }
    input, select, button, textarea { margin: 4px; padding: 6px; }
    .small { font-size: 12px; color: #555; }
  </style>
</head>
<body>
  <h1>Portfolio Factor + Correlation Review</h1>
  <div class="card">
    <button id="loadDefault">Load Dad Portfolio Defaults</button>
    <input type="file" id="csvFile" accept=".csv" />
    <span class="small">CSV columns: ticker,market_value[,kind,underlying,delta,expiration] or ticker,shares,price. For options use kind=option, underlying ticker, delta (-1 to 1), and expiration (YYYY-MM-DD).</span>
    <div id="warnings" class="warn"></div>
  </div>

  <div class="card">
    <h3>Holdings</h3>
    <table id="holdingsTable"></table>
    <button id="addRow">Add Holding</button>
    <button id="run">Run Analytics</button>
  </div>

  <div class="card">
    <h3>Sector / Factor Group Mapping (editable)</h3>
    <p class="small">Set sector and custom factor bucket per ticker. Used to compute grouped bet percentages.</p>
    <table id="classificationTable"></table>
  </div>

  <div class="grid">
    <div class="card"><h3>Portfolio Stats</h3><div id="stats"></div></div>
    <div class="card"><h3>Concentration / Risk</h3><div id="risk"></div></div>
  </div>

  <div class="grid">
    <div class="card"><h3>Sector Diversity</h3><div id="sectorDiversity"></div></div>
    <div class="card"><h3>Factor Bucket Diversity</h3><div id="factorDiversity"></div></div>
  </div>

  <div class="card"><h3>Correlations (1/3/6 month)</h3><div id="corr"></div></div>
  <div class="card"><h3>Rolling correlations vs Portfolio (30/90/180)</h3><div id="rolling"></div></div>
  <div class="card"><h3>Factor Exposures</h3>
    <label>Window: <select id="factorWindow"><option value="126">6 months</option><option value="252">1 year</option><option value="756">3 years</option></select></label>
    <label><input type="checkbox" id="assetFactors" /> Include per-asset regressions</label>
    <button id="rerunFactors">Recompute Factors</button>
    <div id="factors"></div>
  </div>

  <div class="card"><h3>What am I not thinking of?</h3><div id="notThinking"></div></div>
  <div class="card">
    <button id="exportCorr">Export Correlations CSV</button>
    <button id="exportFactors">Export Factors CSV</button>
    <button id="exportGroups">Export Sector/Factor Groups CSV</button>
    <a id="reportLink" href="#" download="portfolio-report.html">Download HTML Snapshot</a>
  </div>

  <script src="/portfolio.js"></script>
</body>
</html>
